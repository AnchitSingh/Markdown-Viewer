<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minimalist Markdown Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
  <style>
    :root {
      --bg-primary: #f8f8f8;
      --bg-secondary: #ffffff;
      --text-primary: #1a1a1a;
      --text-secondary: #4a4a4a;
      --border: #e0e0e0;
      --accent: #333333;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --button-hover: #f1f1f1;
      --modal-overlay: rgba(0, 0, 0, 0.3);
      --font-size-base: 16px;
      --scrollbar-track: rgba(0, 0, 0, 0.05);
      --scrollbar-thumb: rgba(0, 0, 0, 0.2);
    }

    [data-theme="dark"] {
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --text-primary: #f8f8f8;
      --text-secondary: #b0b0b0;
      --border: #333333;
      --accent: #b0b0b0;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      --button-hover: #2a2a2a;
      --modal-overlay: rgba(0, 0, 0, 0.6);
      --scrollbar-track: rgba(255, 255, 255, 0.05);
      --scrollbar-thumb: rgba(255, 255, 255, 0.2);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      height: 100vh;
      display: flex;
      flex-direction: column;
      font-size: var(--font-size-base);
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--scrollbar-track);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--scrollbar-thumb);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent);
    }

    /* Firefox scrollbar */
    * {
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
    }

    header {
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--bg-secondary);
      box-shadow: var(--shadow);
      flex-wrap: wrap;
      gap: 10px;
    }

    .brand {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      white-space: nowrap;
    }

    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    button {
      background: none;
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    button svg {
      min-width: 16px;
    }

    button:hover {
      background-color: var(--button-hover);
    }

    .icon-button {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
    }

    .font-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .font-size-display {
      font-size: 0.875rem;
      color: var(--text-secondary);
      min-width: 28px;
      text-align: center;
    }

    main {
      flex: 1;
      padding: 1rem;
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    @media (min-width: 768px) {
      main {
        padding: 2rem;
        max-width: 800px;
        gap: 1.5rem;
      }

      header {
        padding: 1.5rem;
      }

      button {
        padding: 8px 16px;
      }
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .markdown-content {
      background-color: var(--bg-secondary);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: var(--shadow);
      min-height: 60vh;
      overflow-y: auto;
      flex: 1;
      word-break: break-word;
    }

    @media (min-width: 768px) {
      .markdown-content {
        padding: 2rem;
      }
    }

    /* Mobile menu toggle */
    .menu-toggle {
      display: none;
    }

    @media (max-width: 767px) {
      .menu-toggle {
        display: flex;
        order: 3;
      }

      .header-buttons {
        width: 100%;
        order: 4;
        justify-content: space-between;
        display: none;
      }

      .header-buttons.active {
        display: flex;
      }

      header {
        flex-wrap: wrap;
      }
    }

    /* Markdown styling */
    .markdown-content h1 {
      font-size: calc(1.75em * var(--font-scale, 1));
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
      line-height: 1.3;
    }

    .markdown-content h2 {
      font-size: calc(1.4em * var(--font-scale, 1));
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      line-height: 1.3;
    }

    .markdown-content h3 {
      font-size: calc(1.2em * var(--font-scale, 1));
      margin-top: 1.25rem;
      margin-bottom: 0.5rem;
      line-height: 1.3;
    }

    .markdown-content p {
      margin-bottom: 1rem;
      font-size: calc(1em * var(--font-scale, 1));
      line-height: 1.6;
      max-width: 100%;
    }

    @media (min-width: 768px) {
      .markdown-content p {
        max-width: 65ch;
      }

      .markdown-content h1 {
        font-size: calc(2em * var(--font-scale, 1));
      }

      .markdown-content h2 {
        font-size: calc(1.5em * var(--font-scale, 1));
      }

      .markdown-content h3 {
        font-size: calc(1.25em * var(--font-scale, 1));
      }
    }

    .markdown-content a {
      color: var(--accent);
      text-decoration: none;
      border-bottom: 1px solid var(--accent);
      word-break: break-all;
    }

    .markdown-content ul,
    .markdown-content ol {
      margin-bottom: 1rem;
      padding-left: 1.5rem;
      font-size: calc(1em * var(--font-scale, 1));
    }

    .markdown-content li {
      margin-bottom: 0.5rem;
      line-height: 1.6;
    }

    .markdown-content blockquote {
      border-left: 4px solid var(--border);
      padding-left: 1rem;
      color: var(--text-secondary);
      margin: 1rem 0;
      font-size: calc(1em * var(--font-scale, 1));
    }

    .markdown-content pre {
      background-color: var(--bg-primary);
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
      margin: 1rem 0;
    }

    .markdown-content code {
      font-family: monospace;
      background-color: var(--bg-primary);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-size: calc(0.875em * var(--font-scale, 1));
      overflow-wrap: break-word;
    }

    .markdown-content pre code {
      background-color: transparent;
      padding: 0;
    }

    .markdown-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: calc(1em * var(--font-scale, 1));
      overflow-x: auto;
      display: block;
    }

    @media (min-width: 768px) {
      .markdown-content table {
        display: table;
      }
    }

    .markdown-content th,
    .markdown-content td {
      border: 1px solid var(--border);
      padding: 0.5rem;
      text-align: left;
    }

    .markdown-content th {
      background-color: var(--bg-primary);
    }

    .markdown-content img {
      max-width: 100%;
      height: auto;
      border-radius: 6px;
      margin: 1rem 0;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--modal-overlay);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      padding: 1rem;
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      background-color: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      width: 100%;
      max-width: 600px;
      box-shadow: var(--shadow);
      transform: translateY(-20px);
      transition: transform 0.3s ease;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    @media (min-width: 768px) {
      .modal {
        padding: 2rem;
      }
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal h2 {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
    }

    .modal textarea {
      width: 100%;
      height: 300px;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-family: monospace;
      margin-bottom: 1.5rem;
      resize: vertical;
      flex: 1;
      min-height: 200px;
    }

    .modal-content {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 1.5rem;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      flex-wrap: wrap;
    }

    @media (max-width: 767px) {
      .modal-actions {
        justify-content: center;
      }

      .modal-actions button {
        flex: 1 0 auto;
      }
    }

    .btn-submit {
      background-color: var(--accent);
      color: var(--bg-secondary);
      border: none;
    }

    .btn-submit:hover {
      opacity: 0.9;
    }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      color: var(--text-secondary);
      padding: 1rem;
    }

    .empty-state svg {
      margin-bottom: 1rem;
      width: 64px;
      height: 64px;
      opacity: 0.5;
    }

    .empty-state h2 {
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .empty-state p {
      max-width: 400px;
      margin-bottom: 1.5rem;
    }

    /* Save Name Input */
    .save-input-container {
      position: relative;
      margin-top: 1rem;
      display: none;
    }

    .save-input-container.active {
      display: block;
    }

    .save-input {
      width: 100%;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    /* Saved items list */
    .saved-items-modal .modal {
      min-width: auto;
    }

    @media (min-width: 768px) {
      .saved-items-modal .modal {
        min-width: 500px;
      }
    }

    .saved-items-list {
      list-style: none;
      margin: 0;
      padding: 0;
      max-height: 50vh;
      overflow-y: auto;
    }

    .saved-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background-color 0.2s;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .saved-item:hover {
      background-color: var(--bg-primary);
    }

    .saved-item-name {
      flex: 1;
      font-weight: 500;
      word-break: break-word;
      min-width: 100px;
    }

    .saved-item-date {
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-right: 0.5rem;
      white-space: nowrap;
    }

    .saved-item-actions {
      display: flex;
      gap: 0.5rem;
    }

    .saved-item-action {
      background: none;
      border: none;
      padding: 4px;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .saved-item-action:hover {
      background-color: var(--button-hover);
      color: var(--text-primary);
    }

    .no-saved-items {
      text-align: center;
      padding: 2rem;
      color: var(--text-secondary);
    }

    /* Notifications */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      padding: 1rem;
      border-radius: 8px;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transform: translateY(100px);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
      z-index: 1100;
      max-width: calc(100% - 40px);
    }

    .notification.active {
      transform: translateY(0);
      opacity: 1;
    }

    .notification-icon {
      color: #4CAF50;
      flex-shrink: 0;
    }

    .notification-text {
      font-size: 0.875rem;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Bottom action bar for mobile */
    .mobile-action-bar {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--bg-secondary);
      padding: 0.75rem;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
      justify-content: space-around;
    }

    @media (max-width: 767px) {
      .mobile-action-bar {
        display: flex;
      }

      main {
        padding-bottom: 70px;
        /* Space for the mobile action bar */
      }
    }

    .mobile-action-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      border: none;
      background: none;
      color: var(--text-primary);
      padding: 6px;
    }

    .mobile-action-button svg {
      width: 20px;
      height: 20px;
    }

    .mobile-action-button span {
      font-size: 0.7rem;
    }

    #current-document-info {
      font-size: 0.9rem;
      font-style: italic;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }

    @media (max-width: 767px) {
      #current-document-info {
        max-width: 150px;
      }
    }
  </style>
</head>

<body data-theme="dark">
  <header>
    <div class="brand">Markdown Viewer</div>
    
    <button class="icon-button menu-toggle" id="menu-toggle">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    
    <div class="header-buttons" id="header-buttons">
      <div class="font-controls">
        <button class="icon-button" id="decrease-font">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
        </button>
        <span class="font-size-display" id="font-size-display">16px</span>
        <button class="icon-button" id="increase-font">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
        </button>
      </div>
      <button id="saved-markdown-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
          <polyline points="17 21 17 13 7 13 7 21"></polyline>
          <polyline points="7 3 7 8 15 8"></polyline>
        </svg>
        My Markdown
      </button>
      <button id="new-markdown-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        New
      </button>
      <button class="icon-button" id="theme-toggle">
        <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
    </div>
  </header>


  <main>
    <div class="toolbar">
      <div id="current-document-info"></div>
      <div>
        <button id="save-markdown-btn" style="display: none;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          Save
        </button>
      </div>
    </div>
    <div class="markdown-content" id="markdown-content">
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        <h2>No markdown content yet</h2>
        <p>Click the "New Markdown" button to create your first markdown document</p>
        <button id="empty-new-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          New Markdown
        </button>
      </div>
    </div>
  </main>

  <!-- Edit Markdown Modal -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2>Edit Markdown</h2>
        <button class="close-modal" id="close-modal">&times;</button>
      </div>
      <div class="modal-content">
        <textarea id="markdown-input" placeholder="# Type your markdown here...

## Example heading

This is a paragraph with **bold** and *italic* text.

- List item 1
- List item 2
- List item 3

```
Code block
```

> Blockquote example

[Link example](https://example.com)"></textarea>
      </div>
      <div class="modal-actions">
        <button id="cancel-btn">Cancel</button>
        <button class="btn-submit" id="submit-btn">Render Markdown</button>
      </div>
    </div>
  </div>

  <!-- Save Markdown Modal -->
  <div class="modal-overlay" id="save-modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2>Save Markdown</h2>
        <button class="close-modal" id="close-save-modal">&times;</button>
      </div>
      <div class="modal-content">
        <label for="save-name" style="display: block; margin-bottom: 0.5rem;">Enter a name for your markdown
          document:</label>
        <input type="text" id="save-name" class="save-input" placeholder="My Markdown Document">
      </div>
      <div class="modal-actions">
        <button id="cancel-save-btn">Cancel</button>
        <button class="btn-submit" id="confirm-save-btn">Save Document</button>
      </div>
    </div>
  </div>

  <!-- Saved Markdown Items Modal -->
  <div class="modal-overlay saved-items-modal" id="saved-items-modal">
    <div class="modal">
      <div class="modal-header">
        <h2>My Saved Documents</h2>
        <button class="close-modal" id="close-saved-items">&times;</button>
      </div>
      <div class="modal-content">
        <div id="saved-items-container">
          <ul class="saved-items-list" id="saved-items-list"></ul>
        </div>
      </div>
      <div class="modal-actions">
        <button id="close-saved-items-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <svg class="notification-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
      fill="none" stroke="#4CAF50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
      <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    <span class="notification-text" id="notification-text">Document saved successfully</span>
  </div>

  <script>
    // DOM Elements
    const themeToggle = document.getElementById('theme-toggle');
    const moonIcon = document.getElementById('moon-icon');
    const sunIcon = document.getElementById('sun-icon');
    const modalOverlay = document.getElementById('modal-overlay');
    const saveModalOverlay = document.getElementById('save-modal-overlay');
    const savedItemsModal = document.getElementById('saved-items-modal');
    const newMarkdownBtn = document.getElementById('new-markdown-btn');
    const emptyNewBtn = document.getElementById('empty-new-btn');
    const closeModalBtn = document.getElementById('close-modal');
    const cancelBtn = document.getElementById('cancel-btn');
    const submitBtn = document.getElementById('submit-btn');
    const markdownInput = document.getElementById('markdown-input');
    const markdownContent = document.getElementById('markdown-content');
    const saveMarkdownBtn = document.getElementById('save-markdown-btn');
    const closeSaveModalBtn = document.getElementById('close-save-modal');
    const cancelSaveBtn = document.getElementById('cancel-save-btn');
    const confirmSaveBtn = document.getElementById('confirm-save-btn');
    const saveNameInput = document.getElementById('save-name');
    const savedMarkdownBtn = document.getElementById('saved-markdown-btn'); // This is the "My Markdown" button
    const savedItemsList = document.getElementById('saved-items-list');
    const closeSavedItemsBtn = document.getElementById('close-saved-items-btn');
    const closeSavedItemsX = document.getElementById('close-saved-items');
    const increaseFontBtn = document.getElementById('increase-font');
    const decreaseFontBtn = document.getElementById('decrease-font');
    const fontSizeDisplay = document.getElementById('font-size-display');
    const currentDocumentInfo = document.getElementById('current-document-info');
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notification-text');
    // --- ADDED FOR MOBILE MENU ---
    const menuToggle = document.getElementById('menu-toggle');
    const headerButtons = document.getElementById('header-buttons');
    // --- END ADDED ---

    // App State
    const state = {
      currentContent: '',
      currentDocumentName: '',
      currentDocumentId: null,
      baseFontSize: 16,
      minFontSize: 12,
      maxFontSize: 24,
      fontSizeStep: 1,
    };

    // Initialize
    function init() {
      loadSettings(); // Load settings first to apply theme and font size correctly
      updateThemeIcon();
      loadSavedDocuments(); // Just loads data, doesn't display list yet
      applyFontSize();

      // Check if there's content to display or show empty state
      if (!state.currentContent) {
        resetCurrentDocument(false); // Reset without clearing potentially loaded state
      } else {
        renderMarkdown(state.currentContent);
        updateCurrentDocumentInfo();
        saveMarkdownBtn.style.display = state.currentContent ? 'flex' : 'none';
      }

    }

    // Check if dark mode is enabled
    function isDarkMode() {
      return document.body.getAttribute('data-theme') === 'dark';
    }

    // Update theme toggle icon
    function updateThemeIcon() {
      if (isDarkMode()) {
        moonIcon.style.display = 'none';
        sunIcon.style.display = 'block';
      } else {
        moonIcon.style.display = 'block';
        sunIcon.style.display = 'none';
      }
    }

    // Font size control functions
    function applyFontSize() {
      fontSizeDisplay.textContent = `${state.baseFontSize}px`;
      markdownContent.style.fontSize = `${state.baseFontSize}px`;
      const ratio = state.baseFontSize / 16;
      document.documentElement.style.setProperty('--font-scale', ratio);

      if (state.baseFontSize >= 20) {
        markdownContent.style.setProperty('line-height', '1.8');
      } else if (state.baseFontSize >= 16) {
        markdownContent.style.setProperty('line-height', '1.6');
      } else {
        markdownContent.style.setProperty('line-height', '1.5');
      }
    }

    function increaseFontSize() {
      if (state.baseFontSize < state.maxFontSize) {
        state.baseFontSize += state.fontSizeStep;
        applyFontSize();
        saveSettings();
      }
    }

    function decreaseFontSize() {
      if (state.baseFontSize > state.minFontSize) {
        state.baseFontSize -= state.fontSizeStep;
        applyFontSize();
        saveSettings();
      }
    }

    // Save app settings to localStorage
    function saveSettings() {
      const settings = {
        baseFontSize: state.baseFontSize,
        theme: document.body.getAttribute('data-theme') || 'dark'
      };
      localStorage.setItem('markdownViewerSettings', JSON.stringify(settings));
    }

    // Load app settings from localStorage
    function loadSettings() {
      const settings = JSON.parse(localStorage.getItem('markdownViewerSettings'));
      if (settings) {
        state.baseFontSize = settings.baseFontSize || 16;
        document.body.setAttribute('data-theme', settings.theme || 'dark');
      } else {
        document.body.setAttribute('data-theme', 'dark');
        state.baseFontSize = 16;
      }
      applyFontSize();
      updateThemeIcon();
    }

    // Document management functions
    function generateDocumentId() {
      return Date.now().toString(36) + Math.random().toString(36).substring(2);
    }

    function saveDocument(name, specificIdToUpdate = null) {
      const documents = getSavedDocuments();
      let idToUse = specificIdToUpdate;
      let existingIndex = -1;

      if (idToUse) {
        existingIndex = documents.findIndex(doc => doc.id === idToUse);
      } else {
        const conflictingNameIndex = documents.findIndex(doc => doc.name === name);
        if (conflictingNameIndex !== -1) {
          idToUse = documents[conflictingNameIndex].id;
          existingIndex = conflictingNameIndex;
          console.warn(`Overwriting existing document named "${name}" with ID ${idToUse}`);
        } else {
          idToUse = generateDocumentId();
          console.log(`Creating new document "${name}" with ID ${idToUse}`);
        }
      }

      if (!idToUse) {
        idToUse = generateDocumentId();
        console.log(`Safety net: Generating new ID ${idToUse} for "${name}"`);
      }

      const documentData = {
        id: idToUse,
        name: name,
        content: state.currentContent,
        createdAt: (existingIndex >= 0 && documents[existingIndex].createdAt) ? documents[existingIndex].createdAt : new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };

      if (existingIndex >= 0) {
        documents[existingIndex] = documentData;
      } else {
        documents.push(documentData);
      }

      localStorage.setItem('markdownDocuments', JSON.stringify(documents));
      state.currentDocumentName = name;
      state.currentDocumentId = idToUse;
      updateCurrentDocumentInfo();
      showNotification(`Document "${name}" saved successfully`);
      return documentData;
    }

    function getSavedDocuments() {
      const documents = localStorage.getItem('markdownDocuments');
      try {
        return documents ? JSON.parse(documents) : [];
      } catch (e) {
        console.error("Error parsing saved documents:", e);
        localStorage.removeItem('markdownDocuments');
        return [];
      }
    }

    function loadSavedDocuments() {
      return getSavedDocuments();
    }

    function deleteDocument(id) {
      let documents = getSavedDocuments();
      const docToDelete = documents.find(doc => doc.id === id);
      if (!docToDelete) return documents;

      const name = docToDelete.name;
      documents = documents.filter(doc => doc.id !== id);
      localStorage.setItem('markdownDocuments', JSON.stringify(documents));

      if (state.currentDocumentId === id) {
        resetCurrentDocument();
      }
      showNotification(`Document "${name}" deleted`);
      return documents;
    }

    function loadDocument(id) {
      const documents = getSavedDocuments();
      const documentToLoad = documents.find(doc => doc.id === id);

      if (documentToLoad) {
        state.currentContent = documentToLoad.content;
        state.currentDocumentId = documentToLoad.id;
        state.currentDocumentName = documentToLoad.name;

        renderMarkdown(documentToLoad.content);
        updateCurrentDocumentInfo();
        saveMarkdownBtn.style.display = 'flex';
        closeSavedItemsModal();
        showNotification(`Loaded "${documentToLoad.name}"`);
      } else {
        console.error(`Document with ID ${id} not found.`);
        showNotification(`Error: Document not found`, true);
      }
    }

    function resetCurrentDocument(clearContent = true) {
      if (clearContent) {
        state.currentContent = '';
      }
      state.currentDocumentId = null;
      state.currentDocumentName = '';

      updateCurrentDocumentInfo();
      saveMarkdownBtn.style.display = 'none';

      if (!state.currentContent) {
        markdownContent.innerHTML = `
          <div class="empty-state" id="empty-state-content">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.5;">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <polyline points="10 9 9 9 8 9"></polyline>
              </svg>
              <h2>No markdown loaded</h2>
              <p>Load a document from "My Markdown" or create a new one.</p>
              <button id="empty-new-btn-inner">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                  New Markdown
              </button>
          </div>`;
        const emptyNewBtnInner = document.getElementById('empty-new-btn-inner');
        if (emptyNewBtnInner) {
          emptyNewBtnInner.removeEventListener('click', openEditModal);
          emptyNewBtnInner.addEventListener('click', openEditModal);
        }
      } else {
        renderMarkdown(state.currentContent);
      }
    }

    function updateCurrentDocumentInfo() {
      if (state.currentDocumentName) {
        const safeName = state.currentDocumentName.replace(/</g, "<").replace(/>/g, ">");
        currentDocumentInfo.innerHTML = `
          <span class="document-name" style="display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 0.9rem;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            ${safeName}
          </span>`;
      } else {
        currentDocumentInfo.innerHTML = '';
      }
    }

    let notificationTimeout;
    function showNotification(message, isError = false) {
      clearTimeout(notificationTimeout);
      notificationText.textContent = message;
      const icon = notification.querySelector('.notification-icon');
      if (isError) {
        notification.style.backgroundColor = 'var(--accent)';
        icon.style.stroke = '#f44336';
      } else {
        notification.style.backgroundColor = 'var(--bg-secondary)';
        icon.style.stroke = '#4CAF50';
      }
      notification.classList.add('active');
      notificationTimeout = setTimeout(() => {
        notification.classList.remove('active');
      }, 3000);
    }

    // Modal functions
    function openEditModal() {
      markdownInput.value = state.currentContent || `# New Document\n\nStart typing your markdown here...`;
      modalOverlay.classList.add('active');
      setTimeout(() => markdownInput.focus(), 50);
    }

    function closeEditModal() {
      modalOverlay.classList.remove('active');
    }

    function openSaveModal() {
      saveNameInput.value = state.currentDocumentName || '';
      saveModalOverlay.classList.add('active');
      setTimeout(() => {
        saveNameInput.focus();
        saveNameInput.select();
      }, 50);
    }

    function closeSaveModal() {
      saveModalOverlay.classList.remove('active');
    }

    function openSavedItemsModal() {
      renderSavedItemsList();
      savedItemsModal.classList.add('active');
    }

    function closeSavedItemsModal() {
      savedItemsModal.classList.remove('active');
    }

    function renderSavedItemsList() {
      const documents = loadSavedDocuments();
      if (documents.length === 0) {
        savedItemsList.innerHTML = `<li class="no-saved-items"><p>You haven't saved any documents yet.</p></li>`;
        return;
      }
      documents.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
      savedItemsList.innerHTML = documents.map(doc => {
        const docName = doc.name ? doc.name.replace(/</g, "<").replace(/>/g, ">") : 'Untitled Document';
        const date = doc.updatedAt ? new Date(doc.updatedAt).toLocaleString() : 'N/A';
        return `
          <li class="saved-item" data-id="${doc.id}">
              <div class="saved-item-info" style="flex: 1; margin-right: 1rem; cursor: pointer;" data-action="load" data-id="${doc.id}">
                  <span class="saved-item-name">${docName}</span>
                  <span class="saved-item-date" style="display: block; font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px;">Modified: ${date}</span>
              </div>
              <div class="saved-item-actions">
                  <button class="icon-button saved-item-action" data-action="delete" data-id="${doc.id}" title="Delete ${docName}">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="3 6 5 6 21 6"></polyline>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                          <line x1="10" y1="11" x2="10" y2="17"></line>
                          <line x1="14" y1="11" x2="14" y2="17"></line>
                      </svg>
                  </button>
              </div>
          </li>`;
      }).join('');
      savedItemsList.removeEventListener('click', handleSavedItemClick);
      savedItemsList.addEventListener('click', handleSavedItemClick);
    }

    function handleSavedItemClick(e) {
      const target = e.target.closest('[data-action]');
      if (!target) return;
      const action = target.getAttribute('data-action');
      const id = target.getAttribute('data-id');
      if (!id) return;
      if (action === 'load') {
        loadDocument(id);
      } else if (action === 'delete') {
        const item = target.closest('.saved-item');
        const name = item ? item.querySelector('.saved-item-name')?.textContent : 'this document';
        if (confirm(`Are you sure you want to delete "${name}"? This cannot be undone.`)) {
          deleteDocument(id);
          renderSavedItemsList();
        }
      }
    }

    // Render markdown
    function renderMarkdown(markdown) {
      if (typeof markdown !== 'string' || markdown.trim() === '') {
        if (!state.currentDocumentId) {
          resetCurrentDocument(false);
        } else {
          markdownContent.innerHTML = '<p style="color: var(--text-secondary);"><em>Document is empty.</em></p>';
          saveMarkdownBtn.style.display = 'flex';
        }
      } else {
        try {
          // Make sure marked is loaded
          if (typeof marked !== 'undefined') {
             markdownContent.innerHTML = marked.parse(markdown);
          } else {
             markdownContent.innerHTML = `<p style="color: red;">Error: Marked library not loaded.</p>`;
             console.error("Marked library is not loaded!");
          }
          saveMarkdownBtn.style.display = 'flex';
        } catch (e) {
          console.error("Error parsing Markdown:", e);
          markdownContent.innerHTML = `<p style="color: red;">Error rendering Markdown. Please check your syntax.</p>`;
          saveMarkdownBtn.style.display = 'flex';
        }
      }
      applyFontSize();
    }

    // --- Event Listeners ---

    // Theme Toggle
    themeToggle.addEventListener('click', () => {
      document.body.setAttribute('data-theme', isDarkMode() ? 'light' : 'dark');
      updateThemeIcon();
      saveSettings();
    });

    // Font size control
    increaseFontBtn.addEventListener('click', increaseFontSize);
    decreaseFontBtn.addEventListener('click', decreaseFontSize);

    // --- ADDED: Mobile Menu Toggle ---
    menuToggle.addEventListener('click', () => {
      headerButtons.classList.toggle('active');
    });

    // --- ADDED: Close Mobile Menu on Item Click ---
    headerButtons.addEventListener('click', (e) => {
      // Check if we are in mobile view (approximated by toggle visibility)
      // and if the clicked element is a button or inside a button
      if (menuToggle.offsetParent !== null && headerButtons.classList.contains('active')) {
        if (e.target.closest('button')) {
          // Don't close if it was the font size buttons (or their container)
          if (!e.target.closest('.font-controls')) {
             headerButtons.classList.remove('active');
          }
        }
      }
    });
    // --- END ADDED ---

    // Open Modals
    newMarkdownBtn.addEventListener('click', openEditModal);
    const emptyNewBtnEl = document.getElementById('empty-new-btn');
    if (emptyNewBtnEl) emptyNewBtnEl.addEventListener('click', openEditModal);
    // Listener for button inside empty state is added dynamically in resetCurrentDocument

    saveMarkdownBtn.addEventListener('click', openSaveModal);
    savedMarkdownBtn.addEventListener('click', openSavedItemsModal); // Trigger for "My Markdown"

    // Close Modals (Buttons)
    closeModalBtn.addEventListener('click', closeEditModal);
    cancelBtn.addEventListener('click', closeEditModal);
    closeSaveModalBtn.addEventListener('click', closeSaveModal);
    cancelSaveBtn.addEventListener('click', closeSaveModal);
    closeSavedItemsBtn.addEventListener('click', closeSavedItemsModal);
    closeSavedItemsX.addEventListener('click', closeSavedItemsModal);

    // Close Modals (Overlay Click)
    modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) closeEditModal(); });
    saveModalOverlay.addEventListener('click', (e) => { if (e.target === saveModalOverlay) closeSaveModal(); });
    savedItemsModal.addEventListener('click', (e) => { if (e.target === savedItemsModal) closeSavedItemsModal(); });

    // Submit Markdown from Edit Modal
    submitBtn.addEventListener('click', () => {
      const newMarkdown = markdownInput.value;
      if (newMarkdown !== state.currentContent) {
        state.currentContent = newMarkdown;
        renderMarkdown(newMarkdown);
      }
      closeEditModal();
    });

    // Confirm Save Button Logic
    confirmSaveBtn.addEventListener('click', () => {
      const newName = saveNameInput.value.trim() || 'Untitled Document';
      const currentlyLoadedId = state.currentDocumentId;
      const currentlyLoadedName = state.currentDocumentName;

      if (currentlyLoadedId) {
        if (newName === currentlyLoadedName) {
          saveDocument(newName, currentlyLoadedId);
        } else {
          saveDocument(newName);
        }
      } else {
        saveDocument(newName);
      }
      closeSaveModal();
    });

    // Handle Keyboard Shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (savedItemsModal.classList.contains('active')) closeSavedItemsModal();
        else if (saveModalOverlay.classList.contains('active')) closeSaveModal();
        else if (modalOverlay.classList.contains('active')) closeEditModal();
        e.preventDefault();
      }
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter' && modalOverlay.classList.contains('active')) {
        e.preventDefault();
        submitBtn.click();
      }
      if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        if (state.currentContent) {
          if (state.currentDocumentId && state.currentDocumentName) {
            saveDocument(state.currentDocumentName, state.currentDocumentId);
          } else {
            openSaveModal();
          }
        } else {
          showNotification("Nothing to save", true);
        }
      }
      if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
        e.preventDefault();
        openEditModal();
      }
      if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
        e.preventDefault();
        openSavedItemsModal();
      }
    });

    // Handle Enter key in Save Name Input
    saveNameInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') confirmSaveBtn.click();
    });

    // Initialize the app on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', init);

  </script>
</body>

</html>
